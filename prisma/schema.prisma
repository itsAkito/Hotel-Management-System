generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

// User model for role-based access control
model User {
  id           String    @id // Clerk user ID
  email        String    @unique
  role         String    @default("user") // "user" or "admin"
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

// model Hotel {
//   id                  Int     @id @default(autoincrement())
//   userId              String // Clerk user ID
//   title               String
//   description         String?
//   image               String?
//   country             String?
//   state               String?
//   city                String?
//   locationDescription String?

//   gym          Boolean @default(false)
//   spa          Boolean @default(false)
//   bar          Boolean @default(false)
//   laundry      Boolean @default(false)
//   restaurant   Boolean @default(false)
//   shopping     Boolean @default(false)
//   freeParking  Boolean @default(false)
//   bikeRental   Boolean @default(false)
//   freeWifi     Boolean @default(false)
//   movieNights  Boolean @default(false)
//   swimmingPool Boolean @default(false)
//   coffeeShop   Boolean @default(false)

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   rooms    Room[]
//   bookings Booking[]

//   @@fulltext([title])
// }

// model Room {
//   id             Int     @id @default(autoincrement())
//   title          String
//   description    String?
//   bedCount       Int     @default(0)
//   guestCount     Int     @default(0)
//   bathroomCount  Int     @default(0)
//   kingBed        Int     @default(0)
//   queenBed       Int     @default(0)
//   breakfastPrice Int     @default(0)
//   roomPrice      Int
//   roomService    Boolean @default(false)
//   TV             Boolean @default(false)
//   balcony        Boolean @default(false)
//   freeWifi       Boolean @default(false)
//   oceanView      Boolean @default(false)
//   forestView     Boolean @default(false)
//   mountainView   Boolean @default(false)
//   airCondition   Boolean @default(false)
//   soundProofed   Boolean @default(false)
//   image          String?
//   available      Boolean @default(true)

//   // Relations
//   hotel   Hotel?    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
//   hotelId Int?
//   Booking Booking[]

//   @@index([hotelId])
// }

// model Booking {
//   id               String    @id @default(uuid())
//   userName         String
//   userId           String
//   roomId           String
//   hotelId          String
//   hotelOwnerId     String
//   checkIn          DateTime?
//   checkOut         DateTime?
//   breaFastIncluded Boolean
//   currency         String
//   totalPrice       Int
//   paymentStatus    Boolean   @default(false)
//   paymentIntend    String    @unique
//   bookedAt         DateTime  @default(now())
//   status           String    @default("pending")

//   // Relations
//   hotel   Hotel? @relation(fields: [hotelId], references: [id])
//   Room    Room?  @relation(fields: [hotelId], references: [id])
//   hotelId Int?
//   roomId  Int?
    

//   @@index([hotelId])
//   @@index([roomId])
// }

model Hotel {
  id                  Int     @id @default(autoincrement())
  userId              String  // Clerk user ID
  title               String
  description         String?
  image               String?
  country             String?
  state               String?
  city                String?
  locationDescription String?

  gym          Boolean @default(false)
  spa          Boolean @default(false)
  bar          Boolean @default(false)
  laundry      Boolean @default(false)
  restaurant   Boolean @default(false)
  shopping     Boolean @default(false)
  freeParking  Boolean @default(false)
  bikeRental   Boolean @default(false)
  freeWifi     Boolean @default(false)
  movieNights  Boolean @default(false)
  swimmingPool Boolean @default(false)
  coffeeShop   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  rooms         Room[]
  bookings      Booking[]
  invoices      Invoice[]
  serviceRequests ServiceRequest[]
  hotelInvoices HotelInvoices[]
}

model Room {
  id             Int     @id @default(autoincrement())
  title          String
  description    String?
  bedCount       Int     @default(0)
  guestCount     Int     @default(0)
  bathroomCount  Int     @default(0)
  kingBed        Int     @default(0)
  queenBed       Int     @default(0)
  breakfastPrice Int     @default(0)
  roomPrice      Int
  roomService    Boolean @default(false)
  TV             Boolean @default(false)
  balcony        Boolean @default(false)
  freeWifi       Boolean @default(false)
  oceanView      Boolean @default(false)
  forestView     Boolean @default(false)
  mountainView   Boolean @default(false)
  airCondition   Boolean @default(false)
  soundProofed   Boolean @default(false)
  image          String?
  available      Boolean @default(true)

  // Relations
  hotel   Hotel?   @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  hotelId Int?

  bookings Booking[]

  @@index([hotelId])
}

model Booking {
  id               String   @id @default(uuid())
  userName         String
  userId           String
  hotelOwnerId     String
  checkIn          DateTime?
  checkOut         DateTime?
  breakfastIncluded Boolean
  currency         String
  totalPrice       Int
  paymentStatus    Boolean  @default(false)
  paymentIntent    String   @unique
  bookedAt         DateTime @default(now())
  status           String   @default("pending")

  // Relations
  hotel   Hotel? @relation(fields: [hotelId], references: [id])
  hotelId Int?

  room    Room?  @relation(fields: [roomId], references: [id])
  roomId  Int?

  // New relations
  checkIn_checkout CheckInCheckOut?
  roomAssignment   RoomAssignment?
  guestProfile     GuestProfile?
  invoices         Invoice[]
  serviceRequests  ServiceRequest[]

  @@index([hotelId])
  @@index([roomId])
}

model GuestProfile {
  id              String   @id @default(uuid())
  bookingId       String   @unique
  booking         Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  
  guestFirstName  String
  guestLastName   String
  guestEmail      String
  guestPhone      String
  guestAddress    String?
  guestCity       String?
  guestState      String?
  guestZip        String?
  guestCountry    String?
  
  numberOfGuests  Int
  specialRequests String?
  idType          String? // Passport, Driver License, etc.
  idNumber        String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([bookingId])
}

model CheckInCheckOut {
  id              String   @id @default(uuid())
  bookingId       String   @unique
  booking         Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  
  checkInTime     DateTime?
  checkOutTime    DateTime?
  checkInBy       String? // Staff ID
  checkOutBy      String? // Staff ID
  
  keyIssued       Boolean  @default(false)
  keyReturned     Boolean  @default(false)
  
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([bookingId])
}

model RoomAssignment {
  id              String   @id @default(uuid())
  bookingId       String   @unique
  booking         Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  
  roomNumber      String
  floorNumber     Int?
  assignmentDate  DateTime @default(now())
  assignedBy      String
  
  maintenanceNeeded Boolean @default(false)
  maintenanceNotes  String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([bookingId])
}

model Invoice {
  id              String   @id @default(uuid())
  bookingId       String
  booking         Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  hotelId         Int
  hotel           Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  
  invoiceNumber   String   @unique
  invoiceDate     DateTime @default(now())
  dueDate         DateTime?
  
  roomCharges     Int      @default(0)
  breakfastCharges Int     @default(0)
  serviceCharges  Int      @default(0)
  taxAmount       Int      @default(0)
  discountAmount  Int      @default(0)
  totalAmount     Int      @default(0)
  
  paymentMethod   String?
  paymentDate     DateTime?
  paidAmount      Int      @default(0)
  balanceDue      Int      @default(0)
  
  status          String   @default("pending") // pending, partial, paid
  notes           String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([bookingId])
  @@index([hotelId])
}

model ServiceRequest {
  id              String   @id @default(uuid())
  bookingId       String
  booking         Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  hotelId         Int
  hotel           Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  
  serviceType     String   // room-service, maintenance, housekeeping, etc.
  description     String
  priority        String   @default("normal") // low, normal, high, urgent
  
  requestedAt     DateTime @default(now())
  completedAt     DateTime?
  assignedTo      String?  // Staff ID
  
  status          String   @default("pending") // pending, in-progress, completed, cancelled
  resolution      String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([bookingId])
  @@index([hotelId])
}

model HotelInvoices {
  id              String   @id @default(uuid())
  hotelId         Int
  hotel           Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  
  invoiceNumber   String   @unique
  invoiceDate     DateTime @default(now())
  dueDate         DateTime?
  
  totalAmount     Int
  paidAmount      Int      @default(0)
  balanceDue      Int
  
  status          String   @default("pending")
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([hotelId])
}